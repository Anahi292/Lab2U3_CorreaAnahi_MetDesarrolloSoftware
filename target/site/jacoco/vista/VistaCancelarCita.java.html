<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VistaCancelarCita.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Lab2_U3_CorreaAnahi</a> &gt; <a href="index.source.html" class="el_package">vista</a> &gt; <span class="el_source">VistaCancelarCita.java</span></div><h1>VistaCancelarCita.java</h1><pre class="source lang-java linenums">package vista;

import controlador.ControladorCancelarCita;
import modelo.Cita;
import javax.swing.*;
import javax.swing.border.*;
import javax.swing.table.*;
import java.awt.*;
import java.time.format.DateTimeFormatter;
import java.util.List;

public class VistaCancelarCita extends JFrame {

    private ControladorCancelarCita controlador;
    private JTable tablaCitas;
    private DefaultTableModel modeloTabla;

    private JButton btnCancelar;
    private JButton btnActualizar;
    private JButton btnEliminar;
    private JButton btnVolver;

<span class="fc" id="L23">    private DateTimeFormatter formatter =</span>
<span class="fc" id="L24">            DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy HH:mm&quot;);</span>

<span class="fc" id="L26">    public VistaCancelarCita() {</span>
<span class="fc" id="L27">        configurarVentana();</span>
<span class="fc" id="L28">        inicializarComponentes();</span>
<span class="fc" id="L29">    }</span>

    private void configurarVentana() {
<span class="fc" id="L32">        setTitle(&quot;❌ Cancelar Citas - Sistema de Gestión&quot;);</span>
<span class="fc" id="L33">        setSize(900, 650); // Aumentado el tamaño</span>
<span class="fc" id="L34">        setDefaultCloseOperation(DISPOSE_ON_CLOSE);</span>
<span class="fc" id="L35">        setLocationRelativeTo(null);</span>
<span class="fc" id="L36">        setLayout(new BorderLayout(15, 15));</span>
<span class="fc" id="L37">        getContentPane().setBackground(new Color(245, 246, 250));</span>
<span class="fc" id="L38">    }</span>

    private void inicializarComponentes() {
<span class="fc" id="L41">        add(crearPanelTitulo(), BorderLayout.NORTH);</span>
<span class="fc" id="L42">        add(crearPanelTabla(), BorderLayout.CENTER);</span>
<span class="fc" id="L43">        add(crearPanelBotones(), BorderLayout.SOUTH);</span>
<span class="fc" id="L44">    }</span>

    private JPanel crearPanelTitulo() {
<span class="fc" id="L47">        JPanel panel = new JPanel();</span>
<span class="fc" id="L48">        panel.setBackground(new Color(231, 76, 60));</span>
<span class="fc" id="L49">        panel.setBorder(new EmptyBorder(20, 20, 20, 20));</span>

<span class="fc" id="L51">        JLabel titulo = new JLabel(&quot; Mis Citas Agendadas&quot;);</span>
<span class="fc" id="L52">        titulo.setFont(new Font(&quot;Segoe UI&quot;, Font.BOLD, 28));</span>
<span class="fc" id="L53">        titulo.setForeground(Color.WHITE);</span>

<span class="fc" id="L55">        JLabel sub = new JLabel(&quot;Seleccione una cita para cancelar o eliminar&quot;);</span>
<span class="fc" id="L56">        sub.setFont(new Font(&quot;Segoe UI&quot;, Font.PLAIN, 14));</span>
<span class="fc" id="L57">        sub.setForeground(Color.WHITE);</span>

<span class="fc" id="L59">        panel.setLayout(new BoxLayout(panel, BoxLayout.Y_AXIS));</span>
<span class="fc" id="L60">        titulo.setAlignmentX(Component.CENTER_ALIGNMENT);</span>
<span class="fc" id="L61">        sub.setAlignmentX(Component.CENTER_ALIGNMENT);</span>

<span class="fc" id="L63">        panel.add(titulo);</span>
<span class="fc" id="L64">        panel.add(Box.createVerticalStrut(5));</span>
<span class="fc" id="L65">        panel.add(sub);</span>

<span class="fc" id="L67">        return panel;</span>
    }

    private JPanel crearPanelTabla() {
<span class="fc" id="L71">        String[] columnas = {&quot;ID&quot;, &quot;Nombre&quot;, &quot;Email&quot;, &quot;Teléfono&quot;, &quot;Fecha y Hora&quot;, &quot;Estado&quot;};</span>

<span class="fc" id="L73">        modeloTabla = new DefaultTableModel(columnas, 0) {</span>
            @Override
            public boolean isCellEditable(int r, int c) {
<span class="nc" id="L76">                return false;</span>
            }
        };

<span class="fc" id="L80">        tablaCitas = new JTable(modeloTabla);</span>
<span class="fc" id="L81">        tablaCitas.setRowHeight(35);</span>
<span class="fc" id="L82">        tablaCitas.setFont(new Font(&quot;Segoe UI&quot;, Font.PLAIN, 13));</span>
<span class="fc" id="L83">        tablaCitas.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span>
<span class="fc" id="L84">        tablaCitas.getTableHeader().setFont(new Font(&quot;Segoe UI&quot;, Font.BOLD, 14));</span>
<span class="fc" id="L85">        tablaCitas.getTableHeader().setBackground(new Color(52, 73, 94));</span>
<span class="fc" id="L86">        tablaCitas.getTableHeader().setForeground(Color.WHITE);</span>

        // Configurar anchos de columnas
<span class="fc" id="L89">        tablaCitas.getColumnModel().getColumn(0).setPreferredWidth(50);  // ID</span>
<span class="fc" id="L90">        tablaCitas.getColumnModel().getColumn(1).setPreferredWidth(150); // Nombre</span>
<span class="fc" id="L91">        tablaCitas.getColumnModel().getColumn(2).setPreferredWidth(180); // Email</span>
<span class="fc" id="L92">        tablaCitas.getColumnModel().getColumn(3).setPreferredWidth(100); // Teléfono</span>
<span class="fc" id="L93">        tablaCitas.getColumnModel().getColumn(4).setPreferredWidth(140); // Fecha</span>
<span class="fc" id="L94">        tablaCitas.getColumnModel().getColumn(5).setPreferredWidth(100); // Estado</span>

        // Personalizar el renderizado de la columna Estado
<span class="fc" id="L97">        tablaCitas.getColumnModel().getColumn(5).setCellRenderer(new DefaultTableCellRenderer() {</span>
            @Override
            public Component getTableCellRendererComponent(JTable table, Object value,
                    boolean isSelected, boolean hasFocus, int row, int column) {
<span class="nc" id="L101">                Component c = super.getTableCellRendererComponent(table, value, isSelected, hasFocus, row, column);</span>
                
<span class="nc" id="L103">                String estado = value.toString();</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">                if (estado.equalsIgnoreCase(&quot;Confirmada&quot;)) {</span>
<span class="nc" id="L105">                    c.setForeground(new Color(46, 204, 113));</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">                } else if (estado.equalsIgnoreCase(&quot;Cancelada&quot;)) {</span>
<span class="nc" id="L107">                    c.setForeground(new Color(231, 76, 60));</span>
                }
                
<span class="nc bnc" id="L110" title="All 2 branches missed.">                if (!isSelected) {</span>
<span class="nc" id="L111">                    c.setBackground(Color.WHITE);</span>
                }
                
<span class="nc" id="L114">                return c;</span>
            }
        });

<span class="fc" id="L118">        JScrollPane scroll = new JScrollPane(tablaCitas);</span>
<span class="fc" id="L119">        scroll.setBorder(new LineBorder(Color.LIGHT_GRAY, 1));</span>

<span class="fc" id="L121">        JPanel panel = new JPanel(new BorderLayout());</span>
<span class="fc" id="L122">        panel.setBorder(new EmptyBorder(15, 15, 15, 15));</span>
<span class="fc" id="L123">        panel.setBackground(Color.WHITE);</span>
<span class="fc" id="L124">        panel.add(scroll, BorderLayout.CENTER);</span>

<span class="fc" id="L126">        return panel;</span>
    }

    // CORREGIDO: Panel de botones con FlowLayout explícito
    private JPanel crearPanelBotones() {
        // IMPORTANTE: Usar FlowLayout para que los botones se muestren
<span class="fc" id="L132">        JPanel panel = new JPanel(new FlowLayout(FlowLayout.CENTER, 15, 15));</span>
<span class="fc" id="L133">        panel.setBackground(new Color(245, 246, 250));</span>
<span class="fc" id="L134">        panel.setBorder(new EmptyBorder(10, 10, 10, 10));</span>

        // Crear botones
<span class="fc" id="L137">        btnVolver = crearBoton(&quot;⬅ Volver&quot;, new Color(52, 73, 94));</span>
<span class="fc" id="L138">        btnActualizar = crearBoton(&quot; Actualizar&quot;, new Color(52, 152, 219));</span>
<span class="fc" id="L139">        btnCancelar = crearBoton(&quot; Cancelar Cita&quot;, new Color(231, 76, 60));</span>
<span class="fc" id="L140">        btnEliminar = crearBoton(&quot;️ Eliminar Cita&quot;, new Color(149, 165, 166));</span>

        // Agregar listeners
<span class="pc" id="L143">        btnVolver.addActionListener(e -&gt; dispose());</span>
<span class="fc" id="L144">        btnActualizar.addActionListener(e -&gt; {</span>
<span class="nc" id="L145">            controlador.actualizarListaCitas();</span>
<span class="nc" id="L146">            mostrarMensaje(&quot;Lista actualizada&quot;);</span>
<span class="nc" id="L147">        });</span>
<span class="pc" id="L148">        btnCancelar.addActionListener(e -&gt; cancelarCitaSeleccionada());</span>
<span class="pc" id="L149">        btnEliminar.addActionListener(e -&gt; eliminarCitaSeleccionada());</span>

        // Agregar botones al panel
<span class="fc" id="L152">        panel.add(btnVolver);</span>
<span class="fc" id="L153">        panel.add(btnActualizar);</span>
<span class="fc" id="L154">        panel.add(btnCancelar);</span>
<span class="fc" id="L155">        panel.add(btnEliminar);</span>

<span class="fc" id="L157">        return panel;</span>
    }

    private JButton crearBoton(String texto, Color color) {
<span class="fc" id="L161">        JButton b = new JButton(texto);</span>
<span class="fc" id="L162">        b.setBackground(color);</span>
<span class="fc" id="L163">        b.setForeground(Color.WHITE);</span>
<span class="fc" id="L164">        b.setFont(new Font(&quot;Segoe UI&quot;, Font.BOLD, 14));</span>
<span class="fc" id="L165">        b.setFocusPainted(false);</span>
<span class="fc" id="L166">        b.setBorderPainted(false);</span>
<span class="fc" id="L167">        b.setPreferredSize(new Dimension(190, 45));</span>
<span class="fc" id="L168">        b.setCursor(new Cursor(Cursor.HAND_CURSOR));</span>
        
        // Efecto hover
<span class="fc" id="L171">        b.addMouseListener(new java.awt.event.MouseAdapter() {</span>
            public void mouseEntered(java.awt.event.MouseEvent evt) {
<span class="nc" id="L173">                b.setBackground(color.darker());</span>
<span class="nc" id="L174">            }</span>
            public void mouseExited(java.awt.event.MouseEvent evt) {
<span class="nc" id="L176">                b.setBackground(color);</span>
<span class="nc" id="L177">            }</span>
        });
        
<span class="fc" id="L180">        return b;</span>
    }

    private void cancelarCitaSeleccionada() {
<span class="nc" id="L184">        int fila = tablaCitas.getSelectedRow();</span>

<span class="nc bnc" id="L186" title="All 2 branches missed.">        if (fila == -1) {</span>
<span class="nc" id="L187">            mostrarError(&quot;Por favor, seleccione una cita de la tabla&quot;);</span>
<span class="nc" id="L188">            return;</span>
        }

<span class="nc" id="L191">        String estado = modeloTabla.getValueAt(fila, 5).toString();</span>
<span class="nc bnc" id="L192" title="All 2 branches missed.">        if (estado.equalsIgnoreCase(&quot;Cancelada&quot;)) {</span>
<span class="nc" id="L193">            mostrarError(&quot;Esta cita ya está cancelada&quot;);</span>
<span class="nc" id="L194">            return;</span>
        }

<span class="nc" id="L197">        int id = Integer.parseInt(modeloTabla.getValueAt(fila, 0).toString());</span>
<span class="nc" id="L198">        String nombre = modeloTabla.getValueAt(fila, 1).toString();</span>

<span class="nc" id="L200">        int confirmacion = JOptionPane.showConfirmDialog(</span>
                this,
                &quot;¿Está seguro de cancelar la cita de &quot; + nombre + &quot;?&quot;,
                &quot;Confirmar Cancelación&quot;,
                JOptionPane.YES_NO_OPTION,
                JOptionPane.QUESTION_MESSAGE
        );

<span class="nc bnc" id="L208" title="All 2 branches missed.">        if (confirmacion == JOptionPane.YES_OPTION) {</span>
<span class="nc" id="L209">            controlador.cancelarCita(id);</span>
        }
<span class="nc" id="L211">    }</span>

    private void eliminarCitaSeleccionada() {
<span class="nc" id="L214">        int fila = tablaCitas.getSelectedRow();</span>

<span class="nc bnc" id="L216" title="All 2 branches missed.">        if (fila == -1) {</span>
<span class="nc" id="L217">            mostrarError(&quot;Por favor, seleccione una cita de la tabla&quot;);</span>
<span class="nc" id="L218">            return;</span>
        }

<span class="nc" id="L221">        int id = Integer.parseInt(modeloTabla.getValueAt(fila, 0).toString());</span>
<span class="nc" id="L222">        String nombre = modeloTabla.getValueAt(fila, 1).toString();</span>

<span class="nc" id="L224">        int confirmacion = JOptionPane.showConfirmDialog(</span>
                this,
                &quot;⚠️ ¿Eliminar PERMANENTEMENTE la cita de &quot; + nombre + &quot;?\n&quot; +
                &quot;Esta acción no se puede deshacer.&quot;,
                &quot;Confirmar Eliminación&quot;,
                JOptionPane.YES_NO_OPTION,
                JOptionPane.WARNING_MESSAGE
        );

<span class="nc bnc" id="L233" title="All 2 branches missed.">        if (confirmacion == JOptionPane.YES_OPTION) {</span>
<span class="nc" id="L234">            controlador.eliminarCita(id);</span>
        }
<span class="nc" id="L236">    }</span>

    // ========== MÉTODOS PÚBLICOS USADOS POR EL CONTROLADOR ==========

    public void setControlador(ControladorCancelarCita c) {
<span class="nc" id="L241">        controlador = c;</span>
<span class="nc" id="L242">    }</span>

    public void actualizarTabla(List&lt;Cita&gt; citas) {
<span class="fc" id="L245">        modeloTabla.setRowCount(0);</span>

<span class="pc bpc" id="L247" title="1 of 2 branches missed.">        if (citas.isEmpty()) {</span>
            // Mostrar mensaje cuando no hay citas
<span class="fc" id="L249">            JLabel lblSinCitas = new JLabel(&quot;No hay citas registradas&quot;);</span>
<span class="fc" id="L250">            lblSinCitas.setHorizontalAlignment(SwingConstants.CENTER);</span>
<span class="fc" id="L251">            lblSinCitas.setFont(new Font(&quot;Segoe UI&quot;, Font.ITALIC, 16));</span>
<span class="fc" id="L252">            lblSinCitas.setForeground(Color.GRAY);</span>
        }

<span class="pc bpc" id="L255" title="1 of 2 branches missed.">        for (Cita c : citas) {</span>
<span class="nc" id="L256">            modeloTabla.addRow(new Object[]{</span>
<span class="nc" id="L257">                c.getId(),</span>
<span class="nc" id="L258">                c.getNombreUsuario(),</span>
<span class="nc" id="L259">                c.getEmail(),</span>
<span class="nc" id="L260">                c.getTelefono(),</span>
<span class="nc" id="L261">                c.getFechaHora().format(formatter),</span>
<span class="nc" id="L262">                c.getEstado()</span>
            });
<span class="nc" id="L264">        }</span>

<span class="fc" id="L266">        System.out.println(&quot; Tabla actualizada con &quot; + citas.size() + &quot; citas&quot;);</span>
<span class="fc" id="L267">    }</span>

    public void mostrarExito(String m) {
<span class="nc" id="L270">        JOptionPane.showMessageDialog(this, m, &quot; Operación Exitosa&quot;,</span>
                JOptionPane.INFORMATION_MESSAGE);
<span class="nc" id="L272">    }</span>

    public void mostrarError(String m) {
<span class="nc" id="L275">        JOptionPane.showMessageDialog(this, m, &quot; Error&quot;,</span>
                JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L277">    }</span>

    public void mostrarMensaje(String m) {
<span class="nc" id="L280">        JOptionPane.showMessageDialog(this, m, &quot;️ Información&quot;,</span>
                JOptionPane.INFORMATION_MESSAGE);
<span class="nc" id="L282">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>